---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 
```{r}
require(tidyverse)
require(ggplot2)
require(lubridate)
require(ggpubr)
require(DT)
library(scales)
library(zoo)
require(hrbrthemes)
library(ggrepel)
library(plotly)
library(viridis)
library(hrbrthemes)
```



```{r}
zillow_house = read.csv('ZillowHouseData.csv')
crime_state = read.csv('ucr_by_state.csv')
silver_price = read.csv('Silver.csv')
nc_unemployment = read.csv('NCUR.csv')
national_unemployment = read.csv('NationalUnemployment.csv')
nasdaq = read.csv('Nasdaq.csv')
mortgage_rate = read.csv('MORTGAGE30US.csv')
job_1 = read.csv('Joblosesandgainsbyindustry.csv')
job_2 = read.csv('JobGainsandLossbyindustry.csv')
gold_price = read.csv('GoldPrice.csv')
gdp = read.csv('GDP.csv')
employment = read.csv('EmploymentByIndustry.csv')
oil = read.csv('CrudOil.csv')
consumer_spending = read.csv('ConsumerSpending.csv')
health_data = read.csv('CleanHealth.csv')

national_unemployment = national_unemployment %>% rename(unemployment_rate = UNRATE)
consumer_spending = consumer_spending %>% rename(consumer_spending_USD = CPIAUCSL)
mortgage_rate = mortgage_rate %>% rename(mortgage_rate = MORTGAGE30US )
zillow_house$Date = mdy(zillow_house$Date)
```


Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

```{r}
crime_state = crime_state %>% filter(year > 2002 & year <2013)
crime_state
```

```{r}
national_unemployment$DATE = ymd(national_unemployment$DATE)
str(national_unemployment)

nasdaq$Date = ymd(nasdaq$Date)
str(nasdaq)

consumer_spending$DATE = ymd(consumer_spending$DATE)
str(consumer_spending)

mortgage_rate$DATE = ymd(mortgage_rate$DATE)
str(mortgage_rate)

oil$Date = ymd(oil$Date)
str(oil)

silver_price$Date = ymd(silver_price$Date)
str(silver_price)

gold_price$Date = ymd(gold_price$Date)
str(gold_price)
```

```{r}
format_quarters = function(x) {
  x <- as.yearqtr(x)
  year <- as.integer(x)
  quart <- as.integer(format(x, "%q"))

  paste(c("Q1","Q2","Q3","Q4")[quart], 
        year)
}

# scale_x_date("Year and Month By Quarter", breaks = date_breaks("3 months"), labels = format_quarters)
```


```{r}
ggplot(data = national_unemployment, aes(x=DATE, y=unemployment_rate, group=1)) + geom_line(color='Blue') + theme_bw() + theme(axis.text.x = element_text(angle=90, vjust = 0.5), legend.title=element_blank(), legend.position = c(.4,0.85)) + labs(title = 'National Unemployment by Year')+xlab("DATE")

 ggplot(data = nasdaq, aes(x=Date, y=Close, group=1)) + geom_line(color='Green') + theme_bw() + theme(axis.text.x = element_text(angle=90, vjust = 0.5), legend.title=element_blank(), legend.position = c(.4,0.85)) + labs(title = 'NASDAQ Price by Year ')+xlab("Date")

ggplot(data = consumer_spending, aes(x=DATE, y=consumer_spending_USD, group=1)) + geom_line(color='deepskyblue') + theme_bw() + theme(axis.text.x = element_text(angle=90, vjust = 0.5), legend.title=element_blank(), legend.position = c(.4,0.85)) + labs(title = 'Consumer Spending $USD by Year')+xlab("DATE")

ggplot(data = mortgage_rate, aes(x=DATE, y=mortgage_rate, group=1)) + geom_line(color='darkblue') + theme_bw() + theme(axis.text.x = element_text(angle=90, vjust = 0.5), legend.title=element_blank(), legend.position = c(.4,0.85)) + labs(title = '30 Years Mortgage Rate % by Year')+xlab("DATE")

# ggarrange(unemployment, econ, spend, mortgage, ncol = 2, nrow = 2, width = 6)

```
```{r}
type = function(x) {
  if (x == 'Close') 
    y = 'oil'
  if (x =='Close.y')
    y = 'silver'
  if (x =='Close.x') 
    y = 'gold'
  return(y)
}
```


```{r}
oil_sil_gold = merge(gold_price, silver_price, by = "Date")
oil_sil_gold = merge(oil, oil_sil_gold, by = "Date")
oil_sil_gold = oil_sil_gold %>%select( Date, Close, Close.x, Close.y)

key_cols = c('Close','Close.x','Close.y')
value_col = c('type','type.x','type.y')


oil_sil_gold = gather(oil_sil_gold, key_cols, value_col, Close:Close.y)
oil_sil_gold$type = sapply(oil_sil_gold$key_cols, type)

oil_sil_gold = oil_sil_gold %>% rename(USD_Value = value_col)
```

```{r}
 ggplot(data = nasdaq, aes(x=Date, y=Close, group=1)) + geom_line(color='Green') + theme_bw() + theme(axis.text.x = element_text(angle=90, vjust = 0.5), legend.title=element_blank(), legend.position = c(.4,0.85)) + labs(title = 'NASDAQ Price by Year ')+xlab("Date")

ggplot(data = national_unemployment, aes(x=DATE, y=unemployment_rate, group=1)) + geom_line(color='Blue') + theme_bw() + theme(axis.text.x = element_text(angle=90, vjust = 0.5), legend.title=element_blank(), legend.position = c(.4,0.85)) + labs(title = 'National Unemployment by Year')+xlab("DATE")

oil_sil_gold2 = oil_sil_gold %>% filter(type == 'gold')
ggplot(data = oil_sil_gold2, aes(x=Date, y=USD_Value, group=1)) + geom_line(color='chocolate') + theme_bw() + theme(axis.text.x = element_text(angle=90, vjust = 0.5), legend.title=element_blank(), legend.position = c(.4,0.85)) + labs(title = 'Price Of Gold')+xlab("DATE")


oil_sil_gold3 = oil_sil_gold %>% filter(type == 'oil' | type == 'silver')

ggplot(data = oil_sil_gold3, aes(x=Date, y=USD_Value, group=type, color=type)) + geom_line() + theme_bw() + theme(axis.text.x = element_text(angle=90, vjust = 0.5), legend.title=element_blank(), legend.position = c(.4,0.85)) + labs(title = 'Price Of Gold')+xlab("DATE")
```

```{r}
zillow_house2 = zillow_house %>% group_by(Year=year(Date), State, City) %>% summarize(avg_home_price = mean(House.Price))
zillow_house2
zillow_house3 = zillow_house %>% group_by(Year=year(Date), State) %>% summarize(avg_home_price = mean(House.Price))
zillow_house3
```

```{r}
zillow_house3 %>% 
datatable( 
  #Show custom column headers.
  colnames = c('Year','State', 'Average Home($)'),
  #Show (or not) Row names or Custom row names.
  rownames = FALSE,
  #Where is the filter placed (top, bottom,none)
  filter="top", 
  #css styles on tables
  class = 'stripe hover',
  #Use Captions to generate custom captions.
  caption = htmltools::tags$caption(
    style = 'caption-side: top; 
      text-align: center;',
    htmltools::h2('Average Home Price by State')),
  options = list(pageLength = 15, scrollX=T)) %>% 
  formatRound('avg_home_price',digits = 2)

mortgage_rate2 = mortgage_rate %>% filter(DATE >= '2007-01-04' & DATE <= '2009-12-31')

ggplot(data = mortgage_rate2, aes(x=DATE, y=mortgage_rate, group=1)) + geom_line(color='darkblue') + theme_bw() + theme(axis.text.x = element_text(angle=90, vjust = 0.5), legend.title=element_blank(), legend.position = c(.4,0.85)) + labs(title = '30 Years Mortgage Rate Year')+scale_x_date("Year and Month By Quarter", breaks = date_breaks("3 months"), labels = format_quarters) + ylab('Mortgage Rate %')

states = c('NC','FL','MA','CA','TX')
zillow_house4 = zillow_house3 %>% filter(State %in% states)

ggplot(data = zillow_house4, aes(x=State, y=avg_home_price) ) +
    geom_segment( aes(x=State ,xend=State, y=0, yend=avg_home_price, group = Year), color="grey") +
    geom_point( colour=as.factor(zillow_house4$Year), size = 5)+ geom_label_repel(aes(label = Year), box.padding= 0.35,point.padding = 0.5,
                segment.color = 'grey') + 
  coord_flip() +
    theme_ipsum() +
    theme(
      panel.grid.minor.y = element_blank(),
      panel.grid.major.y = element_blank(),
      legend.position="none"
    ) + scale_y_continuous(labels = comma) + labs(title = 'Avg Home Price By States')+ ylab("AVG Home Price") 


nc_city = c('Greensboro','Winston-Salem','Durham','Chapel Hill','Oak Ridge', 'Charlotte', 'Colfax', 'Wilmington', 'Asheville', 'Ocean Isle Beach')
zillow_house5 = zillow_house2 %>% filter(City %in% nc_city & State == 'NC')
# zillow_house5$Year = as.Date(ISOdate(zillow_house5$Year, 1, 1))

nc_home = ggplot(zillow_house5, aes(x=as.factor(Year), y = avg_home_price, size = avg_home_price, color = City)) + geom_point(alpha = 0.7)  +scale_y_continuous(labels = comma) +  scale_size(range = c(1.4, 10), name="Avg Home Price") +theme_bw()+ theme(axis.text.x = element_text(angle=90, vjust = 0.5)) +labs(title = 'Average Home Price Cities in NC', y= 'Avg Home Price')
nc_home %>% ggplotly() %>% layout 



```

